var Align = function(comparator,match,mismatch) {
	return function(p1,p2) {
		var table = new Array(p1.length + 1);
		var trace = new Array(p1.length + 1);
		for (var i = 0; i < table.length; i++) {
			//var hstring = "";
			table[i] = new Array(p2.length + 1);
			trace[i] = new Array(p2.length + 1);
			for (var j = 0; j < table[i].length; j++) {
				if (i == 0 || j == 0) table[i][j] = 0;
				else {
					var score = comparator(p1[i-1],p2[j-1]);
					var max_score = table[i-1][j-1];
					trace[i][j] = 0;

					if(table[i][j-1] > max_score) {
						max_score = table[i][j-1]; 
						trace[i][j] = 1;
					}
					else if(table[i-1][j] > max_score) {
						max_score = table[i-1][j];
						trace[i][j] = 2;
					}
					table[i][j] = max_score + score;
				}
			}
		}
		var i= table.length-1;
		var j= table[0].length-1;
		while(i>0 && j>0) {
			switch(trace[i][j]) {
				case 0:
				match(p1[i-1],p2[j-1]);
				i--;
				j--;
				break;
				case 1:
				mismatch(p1[i-1],p2[j-1]);
				j--;
				break;
				case 2:
				mismatch(p1[i-1],p2[j-1]);
				i--;
				break;
			}
		}
		delete table;
		return result;
	};
};
